<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pathex.managing.synchronizer module &mdash; PathEx 0.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="pathex.managing.tag module" href="pathex.managing.tag.html" />
    <link rel="prev" title="pathex.managing.region module" href="pathex.managing.region.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> PathEx
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../generalities/index.html">Generalities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../semantics/index.html">Semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">Bibliography</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="pathex.html">pathex package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="pathex.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="pathex.adts.html">pathex.adts package</a></li>
<li class="toctree-l3"><a class="reference internal" href="pathex.expressions.html">pathex.expressions package</a></li>
<li class="toctree-l3"><a class="reference internal" href="pathex.generation.html">pathex.generation package</a></li>
<li class="toctree-l3"><a class="reference internal" href="pathex.machines.html">pathex.machines package</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="pathex.managing.html">pathex.managing package</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="pathex.managing.html#submodules">Submodules</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PathEx</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="pathex.html">pathex package</a> &raquo;</li>
          <li><a href="pathex.managing.html">pathex.managing package</a> &raquo;</li>
      <li>pathex.managing.synchronizer module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/API/pathex.managing.synchronizer.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-pathex.managing.synchronizer">
<span id="pathex-managing-synchronizer-module"></span><h1>pathex.managing.synchronizer module<a class="headerlink" href="#module-pathex.managing.synchronizer" title="Permalink to this headline"></a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="pathex.managing.synchronizer.Synchronizer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Synchronizer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">exp:</span> <span class="pre">Expression</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decomposer:</span> <span class="pre">DecomposerMatch</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lock_class=&lt;built-in</span> <span class="pre">function</span> <span class="pre">allocate_lock&gt;</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pathex/managing/synchronizer.html#Synchronizer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pathex.managing.synchronizer.Synchronizer" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="pathex.managing.manager.html#pathex.managing.manager.Manager" title="pathex.managing.manager.Manager"><code class="xref py py-class docutils literal notranslate"><span class="pre">pathex.managing.manager.Manager</span></code></a>, <a class="reference internal" href="pathex.managing.mixins.html#pathex.managing.mixins.LogbookMixin" title="pathex.managing.mixins.LogbookMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">pathex.managing.mixins.LogbookMixin</span></code></a></p>
<p>This class is a manager that controls the execution of its registered threads.</p>
<p>Example using <a class="reference internal" href="#pathex.managing.synchronizer.Synchronizer.match" title="pathex.managing.synchronizer.Synchronizer.match"><code class="xref py py-meth docutils literal notranslate"><span class="pre">match()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pathex</span> <span class="kn">import</span> <span class="n">Synchronizer</span><span class="p">,</span> <span class="n">Concatenation</span> <span class="k">as</span> <span class="n">C</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># The following expression generates &#39;PiPfCiCf&#39; | &#39;PiPfCiCfPiPfCiCf&#39; | ...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">exp</span> <span class="o">=</span> <span class="o">+</span><span class="n">C</span><span class="p">(</span><span class="s1">&#39;Pi&#39;</span><span class="p">,</span><span class="s1">&#39;Pf&#39;</span><span class="p">,</span><span class="s1">&#39;Ci&#39;</span><span class="p">,</span><span class="s1">&#39;Cf&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sync</span> <span class="o">=</span> <span class="n">Synchronizer</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">produced</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">consumed</span> <span class="o">=</span> <span class="p">[]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">producer</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">sync</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;Pi&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">produced</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">sync</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;Pf&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">consumer</span><span class="p">():</span>
<span class="gp">... </span>    <span class="n">sync</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;Ci&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">consumed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">produced</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>
<span class="gp">... </span>    <span class="n">sync</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;Cf&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">_</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">consumer</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">_</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">producer</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">produced</span> <span class="o">==</span> <span class="p">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">consumed</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">sync</span><span class="o">.</span><span class="n">requests</span><span class="p">(</span><span class="s1">&#39;Pi&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">sync</span><span class="o">.</span><span class="n">permits</span><span class="p">(</span><span class="s1">&#39;Pf&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">sync</span><span class="o">.</span><span class="n">requests</span><span class="p">(</span><span class="s1">&#39;Ci&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">sync</span><span class="o">.</span><span class="n">permits</span><span class="p">(</span><span class="s1">&#39;Cf&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">sync</span><span class="o">.</span><span class="n">permits</span><span class="p">(</span><span class="s1">&#39;WrongTag&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">sync</span><span class="o">.</span><span class="n">requests</span><span class="p">(</span><span class="s1">&#39;WrongTag&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Example using <code class="xref py py-meth docutils literal notranslate"><span class="pre">region()</span></code> as a context manager:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pathex</span> <span class="kn">import</span> <span class="n">Synchronizer</span><span class="p">,</span> <span class="n">Tag</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">named</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">exp</span> <span class="o">=</span> <span class="p">(</span> <span class="n">a</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="o">|</span><span class="n">c</span><span class="p">)</span> <span class="p">)</span><span class="o">+</span><span class="mi">2</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">shared_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">sync</span> <span class="o">=</span> <span class="n">Synchronizer</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func_a</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">with</span> <span class="n">sync</span><span class="o">.</span><span class="n">region</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">shared_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">enter</span><span class="p">)</span>
<span class="gp">... </span>        <span class="c1"># print(&#39;Func a&#39;)</span>
<span class="gp">... </span>        <span class="n">shared_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">exit</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func_b</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">with</span> <span class="n">sync</span><span class="o">.</span><span class="n">region</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">shared_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">enter</span><span class="p">)</span>
<span class="gp">... </span>        <span class="c1"># print(&#39;Func b&#39;)</span>
<span class="gp">... </span>        <span class="n">shared_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">exit</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func_c</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">with</span> <span class="n">sync</span><span class="o">.</span><span class="n">region</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">shared_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">enter</span><span class="p">)</span>
<span class="gp">... </span>        <span class="c1"># print(&#39;Func c&#39;)</span>
<span class="gp">... </span>        <span class="n">shared_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">exit</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">_</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">func_c</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">_</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">func_a</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">_</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">func_b</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">_</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">func_a</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pathex.adts.util</span> <span class="kn">import</span> <span class="n">SET_OF_TUPLES</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">allowed_paths</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">get_language</span><span class="p">(</span><span class="n">SET_OF_TUPLES</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">shared_list</span><span class="p">)</span> <span class="ow">in</span> <span class="n">allowed_paths</span>
</pre></div>
</div>
<p>Example using <code class="xref py py-meth docutils literal notranslate"><span class="pre">region()</span></code> as a function decorator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">anonym</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">exp</span> <span class="o">=</span> <span class="p">(</span> <span class="n">a</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="o">|</span><span class="n">c</span><span class="p">)</span> <span class="p">)</span><span class="o">+</span><span class="mi">2</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">shared_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">sync</span> <span class="o">=</span> <span class="n">Synchronizer</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nd">@sync</span><span class="o">.</span><span class="n">region</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">func_a</span><span class="p">():</span>
<span class="gp">... </span>    <span class="n">shared_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">enter</span><span class="p">)</span>
<span class="gp">... </span>    <span class="c1"># print(&#39;Func a&#39;)</span>
<span class="gp">... </span>    <span class="n">shared_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">exit</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nd">@sync</span><span class="o">.</span><span class="n">region</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">func_b</span><span class="p">():</span>
<span class="gp">... </span>    <span class="n">shared_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">enter</span><span class="p">)</span>
<span class="gp">... </span>    <span class="c1"># print(&#39;Func b&#39;)</span>
<span class="gp">... </span>    <span class="n">shared_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">exit</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func_c</span><span class="p">():</span>
<span class="gp">... </span>    <span class="n">shared_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">enter</span><span class="p">)</span>
<span class="gp">... </span>    <span class="c1"># print(&#39;Func c&#39;)</span>
<span class="gp">... </span>    <span class="n">shared_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">exit</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Another way of applying decoration</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">func_c</span> <span class="o">=</span> <span class="n">sync</span><span class="o">.</span><span class="n">region</span><span class="p">(</span><span class="n">c</span><span class="p">)(</span><span class="n">func_c</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">_</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">func_c</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">_</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">func_a</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">_</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">func_b</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">_</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">func_a</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pathex.adts.util</span> <span class="kn">import</span> <span class="n">SET_OF_TUPLES</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">allowed_paths</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">get_language</span><span class="p">(</span><span class="n">SET_OF_TUPLES</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">shared_list</span><span class="p">)</span> <span class="ow">in</span> <span class="n">allowed_paths</span>
</pre></div>
</div>
<p>Example using <code class="xref py py-meth docutils literal notranslate"><span class="pre">region()</span></code> as a method decorator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Iterable</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">SharedList</span><span class="p">:</span>
<span class="gp">... </span>    <span class="c1"># expression and synchronizer may be defined</span>
<span class="gp">... </span>    <span class="c1"># outside the class if necessary. Here, it are</span>
<span class="gp">... </span>    <span class="c1"># inside the class just for convenience.</span>
<span class="gp">... </span>    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">anonym</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">exp</span> <span class="o">=</span> <span class="p">(</span> <span class="n">a</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="o">|</span><span class="n">c</span><span class="p">)</span> <span class="p">)</span><span class="o">+</span><span class="mi">2</span>
<span class="gp">... </span>    <span class="n">sync</span> <span class="o">=</span> <span class="n">Synchronizer</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_l</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_l</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="nd">@sync</span><span class="o">.</span><span class="n">region</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">func_a</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">enter</span><span class="p">)</span>
<span class="gp">... </span>        <span class="c1"># print(&#39;Func a&#39;)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">exit</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="nd">@sync</span><span class="o">.</span><span class="n">region</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">func_b</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">enter</span><span class="p">)</span>
<span class="gp">... </span>        <span class="c1"># print(&#39;Func b&#39;)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">exit</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">func_c</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">enter</span><span class="p">)</span>
<span class="gp">... </span>        <span class="c1"># print(&#39;Func c&#39;)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">exit</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="c1"># Another way of applying decoration</span>
<span class="gp">... </span>    <span class="n">func_c</span> <span class="o">=</span> <span class="n">sync</span><span class="o">.</span><span class="n">region</span><span class="p">(</span><span class="n">c</span><span class="p">)(</span><span class="n">func_c</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">shared</span> <span class="o">=</span> <span class="n">SharedList</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">_</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">shared</span><span class="o">.</span><span class="n">func_c</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">_</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">shared</span><span class="o">.</span><span class="n">func_a</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">_</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">shared</span><span class="o">.</span><span class="n">func_b</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">_</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">shared</span><span class="o">.</span><span class="n">func_a</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pathex.adts.util</span> <span class="kn">import</span> <span class="n">SET_OF_TUPLES</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">allowed_paths</span> <span class="o">=</span> <span class="n">shared</span><span class="o">.</span><span class="n">exp</span><span class="o">.</span><span class="n">get_language</span><span class="p">(</span><span class="n">SET_OF_TUPLES</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">shared</span><span class="p">)</span> <span class="ow">in</span> <span class="n">allowed_paths</span>
</pre></div>
</div>
<p>Example of <em>readers</em> and <em>writers</em> threads:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">deque</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pathex</span> <span class="kn">import</span> <span class="n">Synchronizer</span><span class="p">,</span> <span class="n">Tag</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">writer</span><span class="p">,</span> <span class="n">reader</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">named</span><span class="p">(</span><span class="s1">&#39;writer&#39;</span><span class="p">,</span> <span class="s1">&#39;reader&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">exp</span> <span class="o">=</span> <span class="p">(</span><span class="n">writer</span> <span class="o">|</span> <span class="n">reader</span><span class="o">//...</span><span class="p">)</span><span class="o">+...</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sync</span> <span class="o">=</span> <span class="n">Synchronizer</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">shared_buffer</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@sync</span><span class="o">.</span><span class="n">region</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">shared_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@sync</span><span class="o">.</span><span class="n">region</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">get_top</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">x</span> <span class="o">=</span> <span class="n">shared_buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">... </span>    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="kc">None</span>
<span class="gp">... </span>    <span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">x</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@sync</span><span class="o">.</span><span class="n">region</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">appendleft</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">shared_buffer</span><span class="o">.</span><span class="n">appendleft</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">()</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">append</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>
<span class="gp">... </span>    <span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">get_top</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>
<span class="gp">... </span>    <span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">appendleft</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">shared_buffer</span> <span class="o">==</span> <span class="n">deque</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
</pre></div>
</div>
<dl class="field-list simple">
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="pathex.managing.synchronizer.Synchronizer.match">
<span class="sig-name descname"><span class="pre">match</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">label</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Hashable</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.10)"><span class="pre">object</span></a></span></span><a class="headerlink" href="#pathex.managing.synchronizer.Synchronizer.match" title="Permalink to this definition"></a></dt>
<dd><p>This method is used to wait for the availability of a single label.</p>
<p>If the expression of the synchronizer is not able to generate the given object then the execution is blocked until the presence of another label in another task advances the associated expression’s automata, so it can generate the label given in this method.</p>
<p>The direct use of this method should be exercised with caution, because it leads to non structured code. In fact, in an object oriented design, its use should be discouraged. This method is public just because it might be usefull in a very specific and extraordinary use case where an structured approach may be too expensive, harder to design or to maintain.</p>
<p>For an structured approach use the decorator <code class="xref py py-meth docutils literal notranslate"><span class="pre">register()</span></code> or the context manager <code class="xref py py-meth docutils literal notranslate"><span class="pre">region()</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>label</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.10)"><em>object</em></a>) – The label to wait for.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pathex.managing.synchronizer.Synchronizer.permits">
<span class="sig-name descname"><span class="pre">permits</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">label</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.10)"><span class="pre">object</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><span class="pre">int</span></a></span></span><a class="reference internal" href="../_modules/pathex/managing/synchronizer.html#Synchronizer.permits"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pathex.managing.synchronizer.Synchronizer.permits" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pathex.managing.synchronizer.Synchronizer.requests">
<span class="sig-name descname"><span class="pre">requests</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">label</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.10)"><span class="pre">object</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><span class="pre">int</span></a></span></span><a class="reference internal" href="../_modules/pathex/managing/synchronizer.html#Synchronizer.requests"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pathex.managing.synchronizer.Synchronizer.requests" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
</dl>
</dd></dl>

</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="pathex.managing.region.html" class="btn btn-neutral float-left" title="pathex.managing.region module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="pathex.managing.tag.html" class="btn btn-neutral float-right" title="pathex.managing.tag module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2021, Ernesto Soto Gómez.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>