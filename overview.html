<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Overview &mdash; PathEx 0.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Generalities" href="generalities/index.html" />
    <link rel="prev" title="Welcome to PathEx’s documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> PathEx
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#usage">Usage</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="generalities/index.html">Generalities</a></li>
<li class="toctree-l1"><a class="reference internal" href="semantics/index.html">Semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="API/pathex.html">pathex package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PathEx</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Overview</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/overview.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h1>
<p>This section roughly presents the main features of PathEx.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt>Document <a class="reference internal" href="generalities/index.html"><span class="doc">Generalities</span></a></dt><dd><p>A more in depth explanation of PathEx features.</p>
</dd>
<dt>Document <a class="reference internal" href="semantics/index.html"><span class="doc">Semantics</span></a></dt><dd><p>A more rigorous explanation of PathEx features.</p>
</dd>
</dl>
</div>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline"></a></h2>
<p>First, construct some tags that will represent the regions to be synchronized:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathex</span> <span class="kn">import</span> <span class="n">Tag</span>

<span class="n">writer</span><span class="p">,</span> <span class="n">reader</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">named</span><span class="p">(</span><span class="s1">&#39;writer&#39;</span><span class="p">,</span> <span class="s1">&#39;reader&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Then, create an expression that specify the allowed paths of execution:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">exp</span> <span class="o">=</span> <span class="p">(</span><span class="n">writer</span> <span class="o">|</span> <span class="n">reader</span><span class="o">//...</span><span class="p">)</span><span class="o">+...</span>
</pre></div>
</div>
<p>In this case the expression specify that a single writer or a set of concurrent readers may be executed. Also, these paths of execution may be repeated many times in sequence. For example, the following is an allowed path <a class="footnote-reference brackets" href="#id2" id="id1">1</a>: <code class="docutils literal notranslate"><span class="pre">reader</span> <span class="pre">writer</span> <span class="pre">writer</span> <span class="pre">{reader,</span> <span class="pre">reader}</span> <span class="pre">writer</span></code>, but the following is not: <code class="docutils literal notranslate"><span class="pre">{reader</span> <span class="pre">writer}</span> <span class="pre">writer</span> <span class="pre">{reader,</span> <span class="pre">reader}</span> <span class="pre">writer</span></code>.</p>
<dl class="footnote brackets">
<dt class="label" id="id2"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">{</span></code> and <code class="docutils literal notranslate"><span class="pre">}</span></code> are used to specify a set of concurrent tasks.</p>
</dd>
</dl>
<p>Next, if you are using threads, create a <a class="reference internal" href="API/pathex.managing.synchronizer.html#pathex.managing.synchronizer.Synchronizer" title="pathex.managing.synchronizer.Synchronizer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Synchronizer</span></code></a> that will serve as a manager of the execution flow.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathex</span> <span class="kn">import</span> <span class="n">Synchronizer</span>

<span class="n">sync</span> <span class="o">=</span> <span class="n">Synchronizer</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
</pre></div>
</div>
<p>In the case of processes, use <a class="reference internal" href="API/pathex.managing.processes.html#pathex.managing.processes.get_synchronizer" title="pathex.managing.processes.get_synchronizer"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_synchronizer()</span></code></a> instead:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathex</span> <span class="kn">import</span> <span class="n">Tag</span><span class="p">,</span> <span class="n">get_synchronizer</span>

<span class="n">sync</span> <span class="o">=</span> <span class="n">get_synchronizer</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
</pre></div>
</div>
<p>To mark a function as a region to be synchronized use <a class="reference internal" href="API/pathex.managing.manager.html#pathex.managing.manager.Manager.region" title="pathex.managing.manager.Manager.region"><code class="xref py py-meth docutils literal notranslate"><span class="pre">region()</span></code></a>. It can be used in the case of threads as well as in the case of processes. For example:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@sync</span><span class="o">.</span><span class="n">region</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="n">shared_buffer</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="n">shared_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="nd">@sync</span><span class="o">.</span><span class="n">region</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_top</span><span class="p">(</span><span class="n">shared_buffer</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
       <span class="n">x</span> <span class="o">=</span> <span class="n">shared_buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
       <span class="k">return</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
       <span class="k">return</span> <span class="n">x</span>

<span class="nd">@sync</span><span class="o">.</span><span class="n">region</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">appendleft</span><span class="p">(</span><span class="n">shared_buffer</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="n">shared_buffer</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="API/pathex.managing.manager.html#pathex.managing.manager.Manager.region" title="pathex.managing.manager.Manager.region"><code class="xref py py-meth docutils literal notranslate"><span class="pre">region()</span></code></a> can be used as a context manager as well:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="n">shared_buffer</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">sync</span><span class="o">.</span><span class="n">region</span><span class="p">(</span><span class="n">writer</span><span class="p">):</span>
       <span class="n">shared_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_top</span><span class="p">(</span><span class="n">shared_buffer</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">sync</span><span class="o">.</span><span class="n">region</span><span class="p">(</span><span class="n">reader</span><span class="p">):</span>
       <span class="k">try</span><span class="p">:</span>
          <span class="n">x</span> <span class="o">=</span> <span class="n">shared_buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
       <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
          <span class="k">return</span> <span class="kc">None</span>
       <span class="k">else</span><span class="p">:</span>
          <span class="k">return</span> <span class="n">x</span>

<span class="k">def</span> <span class="nf">appendleft</span><span class="p">(</span><span class="n">shared_buffer</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">sync</span><span class="o">.</span><span class="n">region</span><span class="p">(</span><span class="n">writer</span><span class="p">):</span>
       <span class="n">shared_buffer</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>In the shown examples <code class="docutils literal notranslate"><span class="pre">shared_buffer</span></code> may be specified as a global variable, but it is a good practice to define it as a parameter to use a common idiom no matter we are using threads or processes.</p>
<p>Once the regions to be synchronized are specified, threads (or processes) may be started by using any of the known standard methods. For example, we may define a function to spawn the concurrent tasks, that takes an <a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.Executor" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> class and a shared buffer:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">spawn_tasks</span><span class="p">(</span><span class="n">Executor</span><span class="p">,</span> <span class="n">shared_buffer</span><span class="p">):</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">with</span> <span class="n">Executor</span><span class="p">()</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
       <span class="n">tasks</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">append</span><span class="p">,</span> <span class="n">shared_buffer</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)])</span>
       <span class="n">tasks</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">get_top</span><span class="p">,</span> <span class="n">shared_buffer</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)])</span>
       <span class="n">tasks</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">appendleft</span><span class="p">,</span> <span class="n">shared_buffer</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)])</span>

       <span class="n">done</span><span class="p">,</span> <span class="n">not_done</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">tasks</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_when</span><span class="o">=</span><span class="n">cf</span><span class="o">.</span><span class="n">ALL_COMPLETED</span><span class="p">)</span>
       <span class="k">assert</span> <span class="ow">not</span> <span class="n">not_done</span>
</pre></div>
</div>
<p>In the case of threads we use <a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.ThreadPoolExecutor" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ThreadPoolExecutor</span></code></a> and a simple <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a> as a shared buffer:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>

   <span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>

   <span class="n">shared_buffer</span> <span class="o">=</span> <span class="p">[]</span>

   <span class="n">spawn_tasks</span><span class="p">(</span><span class="n">ThreadPoolExecutor</span><span class="p">,</span> <span class="n">shared_buffer</span><span class="p">)</span>

   <span class="k">assert</span> <span class="n">shared_buffer</span> <span class="o">==</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
<p>The condition <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">'__main__':</span> <span class="pre">...</span></code> is not necessary for threads, but it is a good practice to use it as a common idiom for threads and processes.</p>
<p>In the case of processes <a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.ProcessPoolExecutor" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ProcessPoolExecutor</span></code></a> may be used and a <a class="reference external" href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing-proxy-objects" title="(in Python v3.10)"><span class="xref std std-ref">proxy</span></a> to a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a> obtained from the underlain <a class="reference external" href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.managers.SyncManager" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SyncManager</span></code></a> as the shared proxy.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>

   <span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ProcessPoolExecutor</span>

   <span class="n">manager</span> <span class="o">=</span> <span class="n">sync</span><span class="o">.</span><span class="n">get_mp_manager</span><span class="p">()</span>
   <span class="n">shared</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>

   <span class="n">spawn_tasks</span><span class="p">(</span><span class="n">ProcessPoolExecutor</span><span class="p">,</span> <span class="n">shared_buffer</span><span class="p">)</span>

   <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">shared_buffer</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
<p>In any case, the synchronizer will manage any request of execution and will allow only those in accord with the given expression and the current state of execution. Disallowed requests are suspended until the appropriate execution conditions are met.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to PathEx’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="generalities/index.html" class="btn btn-neutral float-right" title="Generalities" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2021, Ernesto Soto Gómez.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>